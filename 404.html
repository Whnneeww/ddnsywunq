<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>無限の世界生成マップ</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #map {
            position: absolute;
            width: 100vw;
            height: 100vh;
            background-color: #e0f7fa;
            touch-action: none; /* タッチアクションを無効にする */
        }
        .world {
            position: absolute;
            white-space: nowrap;
            font-size: 2rem; /* 要素のサイズを大きく */
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        const elements = ['🌲森', '🏔️山', '🌊川', '🏖️ビーチ', '🏡村', '🏙️町', '🏜️砂漠', '🌌洞窟'];
        let worldSize = 100;
        let worldMap = {};

        // 世界を生成する関数
        function generateWorld() {
            let world = [];
            for (let i = 0; i < worldSize; i++) {
                const randomElement = elements[Math.floor(Math.random() * elements.length)];
                const position = {
                    left: Math.floor(Math.random() * window.innerWidth),
                    top: Math.floor(Math.random() * window.innerHeight)
                };
                world.push({ element: randomElement, position });
            }
            return world;
        }

        // 世界を表示する関数
        function displayWorld(world) {
            const mapDiv = document.getElementById('map');
            mapDiv.innerHTML = ''; // 初期化
            world.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('world');
                div.style.left = `${item.position.left}px`;
                div.style.top = `${item.position.top}px`;
                div.textContent = item.element;
                mapDiv.appendChild(div);
            });
        }

        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        const mapDiv = document.getElementById('map');
        let initialDistance = null;
        let lastTouchX = 0;
        let lastTouchY = 0;

        const touchStartHandler = (event) => {
            if (event.touches.length === 2) {
                // ピンチ開始の距離を計測
                initialDistance = Math.hypot(
                    event.touches[0].clientX - event.touches[1].clientX,
                    event.touches[0].clientY - event.touches[1].clientY
                );
            } else if (event.touches.length === 1) {
                lastTouchX = event.touches[0].clientX;
                lastTouchY = event.touches[0].clientY;
            }
        };
        
        const touchMoveHandler = (event) => {
            event.preventDefault(); // デフォルトのスクロールを防ぐ
            if (event.touches.length === 1) {
                // スワイプ移動
                const currentX = event.touches[0].clientX;
                const currentY = event.touches[0].clientY;
                translateX += currentX - lastTouchX;
                translateY += currentY - lastTouchY;
                lastTouchX = currentX;
                lastTouchY = currentY;
            } else if (event.touches.length === 2) {
                const newDistance = Math.hypot(
                    event.touches[0].clientX - event.touches[1].clientX,
                    event.touches[0].clientY - event.touches[1].clientY
                );
                scale *= newDistance / initialDistance; // ズームスケールを更新
                initialDistance = newDistance; // 現在の距離を初期距離に更新
            }
            applyTransform();
        };

        const applyTransform = () => {
            mapDiv.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
            // ズームアウトの際に全体を見渡せるように調整
            const adjustedTranslateX = translateX / scale;
            const adjustedTranslateY = translateY / scale;
            const width = window.innerWidth * scale;
            const height = window.innerHeight * scale;

            // ここで白い部分が見えないように、表示範囲を調整
            if (adjustedTranslateX < 0) translateX = 0;
            if (adjustedTranslateY < 0) translateY = 0;
            if (adjustedTranslateX + width > mapDiv.offsetWidth) {
                translateX = mapDiv.offsetWidth - width;
            }
            if (adjustedTranslateY + height > mapDiv.offsetHeight) {
                translateY = mapDiv.offsetHeight - height;
            }
        }

        // ページが読み込まれた後に世界を表示
        window.onload = function() {
            const newWorld = generateWorld();
            displayWorld(newWorld);
            mapDiv.addEventListener('touchstart', touchStartHandler);
            mapDiv.addEventListener('touchmove', touchMoveHandler);
        };
    </script>
</body>
</html>
